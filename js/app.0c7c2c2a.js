(function(){"use strict";var t={9384:function(t,e,i){var s=i(6369),n=function(){var t=this,e=t._self._c;return e("div",[e("Kaudio"),e("Kvideo")],1)},o=[],a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"recorder-wrapper"},[e("div",{staticClass:"phone"},[e("div",{staticClass:"phone-body"},[t._m(0),e("div",{staticClass:"phone-content"},[e("transition-group",{staticClass:"msg-list",attrs:{tag:"ul",name:"fade"}},[e("li",{key:-1,staticClass:"msg eg"},[e("div",{staticClass:"avatar"}),e("div",{staticClass:"audio"},[t._v("说话")])]),t._l(t.chunkList,(function(i,s){return e("li",{key:s,staticClass:"msg",on:{click:function(e){return t.onPlay(s)},touchend:function(e){return e.preventDefault(),t.onPlay(s)}}},[e("div",{staticClass:"avatar"}),e("div",{staticClass:"audio",class:{wink:i.wink},style:{width:20*i.duration+"px"}},[e("span",[t._v("(")]),e("span",[t._v("(")]),e("span",[t._v("(")])]),e("div",{staticClass:"duration"},[t._v(t._s(i.duration)+'"')])])}))],2)],1),e("div",{staticClass:"phone-operate",on:{mousedown:t.onMousedown,touchstart:function(e){return e.preventDefault(),t.onMousedown.apply(null,arguments)},mouseup:t.onMouseup,touchend:function(e){return e.preventDefault(),t.onMouseup.apply(null,arguments)}}},[t._v(t._s(t.btnText))])])]),e("audio",{ref:"audio"})])},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"phone-head"},[e("span",[t._v("< 微信(66)")]),e("span",[t._v("哈哈哈")]),e("span",[t._v("···")])])}],u=(i(7658),{data(){return{chunks:[],chunkList:[],btnText:"按住说话"}},methods:{requestAudioAccess(){navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{this.recorder=new window.MediaRecorder(t),this.bindEvents()}),(t=>{alert("出错，请确保已允许浏览器获取录音权限")}))},onMousedown(){this.onStart(),this.btnText="松开结束"},onMouseup(){this.onStop(),this.btnText="按住说话"},onStart(){this.recorder.start()},onStop(){this.recorder.stop()},onPlay(t){this.chunkList.forEach((t=>{this.$set(t,"wink",!1)}));let e=this.chunkList[t];this.audio.src=e.stream,this.audio.play(),this.bindAudioEvent(t)},bindAudioEvent(t){let e=this.chunkList[t];this.audio.onplaying=()=>{this.$set(e,"wink",!0)},this.audio.onended=()=>{this.$set(e,"wink",!1)}},bindEvents(){this.recorder.ondataavailable=this.getRecordingData,this.recorder.onstop=this.saveRecordingData},getRecordingData(t){this.chunks.push(t.data)},saveRecordingData(){let t=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"}),e=URL.createObjectURL(t),i=parseInt(t.size/6600);i<=0?alert("说话时间太短"):(i>60&&(i=60),this.chunkList.push({duration:i,stream:e}),this.chunks=[])}},mounted(){navigator.mediaDevices?window.MediaRecorder?(this.audio=this.$refs.audio,this.requestAudioAccess()):alert("您的浏览器不支持录音"):alert("您的浏览器不支持获取用户设备")}}),d=u,c=i(1001),h=(0,c.Z)(d,a,r,!1,null,"5fb2f822",null),l=h.exports,v=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"recorder-wrapper"},[e("div",{staticClass:"phone"},[e("div",{staticClass:"phone-body"},[t._m(0),e("div",{staticClass:"phone-content"},[e("transition-group",{staticClass:"msg-list",attrs:{tag:"ul",name:"fade"}},[e("li",{key:-1,staticClass:"msg eg"},[e("div",{staticClass:"avatar"}),e("div",{staticClass:"video"},[t._v("拍段视频吧")])]),t._l(t.chunkList,(function(i,s){return e("li",{key:s,staticClass:"msg"},[e("div",{staticClass:"avatar"}),e("div",{staticClass:"video",on:{click:function(e){return t.onPlay(s)},touchend:function(e){return e.preventDefault(),t.onPlay(s)}}},[e("img",{attrs:{alt:"截图",src:i.poster}}),e("i",{staticClass:"el-icon-caret-right"})])])}))],2)],1),e("div",{staticClass:"phone-operate",on:{mousedown:t.onMousedown,touchstart:function(e){return e.preventDefault(),t.onMousedown.apply(null,arguments)},mouseup:t.onMouseup,touchend:function(e){return e.preventDefault(),t.onMouseup.apply(null,arguments)}}},[t._v(t._s(t.btnText))]),e("video",{ref:"video",attrs:{width:"200"},on:{click:function(e){return t.showVideo(!1)},touchend:function(e){return e.preventDefault(),t.showVideo(!1)}}})])]),e("canvas",{ref:"canvas"})])])},p=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"phone-head"},[e("span",[t._v("< 微信(66)")]),e("span",[t._v("哈哈哈")]),e("span",[t._v("···")])])}],f={data(){return{chunks:[],chunkList:[],btnText:"按住拍视频",index:0}},methods:{requestAudioAccess(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((t=>{this.recorder=new window.MediaRecorder(t),this.stream=t,this.bindEvents(),this.onMousedown()}),(()=>{alert("出错，请确保已允许浏览器获取音视频权限")}))},onMousedown(){this.showVideo(!0),this.onPreview(),this.btnText="松开结束",this.onStart()},onMouseup(){this.onStop(),this.btnText="按住拍视频"},onPreview(){this.video.srcObject=this.stream,this.video.muted=!0,this.video.play()},showVideo(t){t?this.video.style.display="block":(this.video.style.display="none",this.video.pause())},onStart(){this.recorder.start()},onStop(){this.recorder.stop()},onPlay(t){this.showVideo(!0);let e=this.chunkList[t];this.video.src=e.stream,this.video.muted=!1,this.video.play(),this.bindAudioEvent()},bindAudioEvent(){this.video.onended=()=>{this.showVideo(!1)}},bindEvents(){this.recorder.ondataavailable=this.getRecordingData,this.recorder.onstop=this.saveRecordingData},getRecordingData(t){this.chunks.push(t.data)},saveRecordingData(){let t=new Blob(this.chunks,{type:"video/webm"}),e=URL.createObjectURL(t);this.chunkList.push({stream:e}),this.onCapture(this.index),this.chunks=[]},onCapture(t){let e=this.chunkList[t];this.ctx.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),this.canvas.toBlob((t=>{let i=URL.createObjectURL(t);this.$set(e,"poster",i)})),this.index++,this.showVideo(!1),this.video.srcObject=null}},mounted(){navigator.mediaDevices?window.MediaRecorder?(this.video=this.$refs.video,this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.requestAudioAccess()):alert("您的浏览器不支持录音"):alert("您的浏览器不支持获取用户设备")}},w=f,b=(0,c.Z)(w,v,p,!1,null,"6b8de310",null),g=b.exports,m={components:{Kaudio:l,Kvideo:g}},k=m,y=(0,c.Z)(k,n,o,!1,null,"18bd4ceb",null),C=y.exports;s.ZP.config.productionTip=!1,new s.ZP({render:t=>t(C)}).$mount("#app")}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}i.m=t,function(){var t=[];i.O=function(e,s,n,o){if(!s){var a=1/0;for(c=0;c<t.length;c++){s=t[c][0],n=t[c][1],o=t[c][2];for(var r=!0,u=0;u<s.length;u++)(!1&o||a>=o)&&Object.keys(i.O).every((function(t){return i.O[t](s[u])}))?s.splice(u--,1):(r=!1,o<a&&(a=o));if(r){t.splice(c--,1);var d=n();void 0!==d&&(e=d)}}return e}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[s,n,o]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var n,o,a=s[0],r=s[1],u=s[2],d=0;if(a.some((function(e){return 0!==t[e]}))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);if(u)var c=u(i)}for(e&&e(s);d<a.length;d++)o=a[d],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(c)},s=self["webpackChunkaudio"]=self["webpackChunkaudio"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(9384)}));s=i.O(s)})();
//# sourceMappingURL=app.0c7c2c2a.js.map